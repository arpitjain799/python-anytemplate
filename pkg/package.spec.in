%global pkgname anytemplate

%if 0%{?fedora} || 0%{?rhel} > 7
%bcond_without python3
%else
%bcond_with python3
%endif

%global desc \
Python library works as an abstraction layer for various python template\
engines and rendering libraries, and provide a few very simple and easily\
understandable APIs to render templates.\
\
Also a CLI tool called anytemplate_cli is provided to render templates written\
in these template languages.

Name:           python-%{pkgname}
Version:        @VERSION@
Release:        1%{?dist}
Summary:        Python library provides common APIs for various template engines
Group:          Development/Tools
License:        MIT
URL:            https://github.com/ssato/python-anytemplate
Source0:        %{url}/archive/RELEASE_%{version}.tar.gz
BuildArch:      noarch

%if 0%{?rhel} == 7
BuildRequires:  python-setuptools
BuildRequires:  python-devel
%else
BuildRequires:  python2-setuptools
BuildRequires:  python2-devel
%endif
%if %{with python3}
BuildRequires:  python3-devel
BuildRequires:  python3-setuptools
%endif

%description %{desc}

%package -n python2-%{pkgname}
Summary:        %{summary}
Requires:       PyYAML
Requires:       python2-jinja2
Requires:       python2-anyconfig
%{?python_provide:%python_provide python2-%{pkgname}}

%description -n python2-%{pkgname} %{desc}

%if %{with python3}
%package -n python3-%{pkgname}
Summary:        %{summary}
Requires:       python3-PyYAML
Requires:       python3-jinja2
Requires:       python3-anyconfig
%{?python_provide:%python_provide python3-%{pkgname}}

%description -n python3-%{pkgname} %{desc}

This is a version for python-3.x.
%endif

%prep
%autosetup -n %{pkgname}-%{version}

%build
%py2_build
%if %{with python3}
%py3_build
%endif

%install
%py2_install
%if %{with python3}
%py3_install
%endif

%files -n python2-%{pkgname}
%doc README.rst examples
%{python_sitelib}/*

%if %{with python3}
%files -n python3-%{pkgname}
%doc README.rst examples
%{python3_sitelib}/*
%endif
%{_bindir}/*

%changelog
* Fri Jan  5 2018 Satoru SATOH <ssato@redhat.com> - 0.1.4-1
- enhancement: support to load templates and contexts from stdin '-'
- fix/refactor: clean up the RPM SPEC to comply w/ the Fedora python guidelines

* Sat Nov 18 2017 Satoru SATOH <ssato@redhat.com> - 0.1.3-1
- fix: make it runnable even if locale is not set such like in docker env
- fix: some warnings such as deprecated-method, no-else-return and invalid-name

* Sun Oct 29 2017 Satoru SATOH <ssato@redhat.com> - 0.1.2-1
- fix: remove macro expansion in the comment line in this RPM SPEC
- fix: remove duplicated buildarch lines in this RPM SPEC

* Tue Apr 25 2017 Satoru SATOH <ssato@redhat.com> - 0.1.1-1
- fix: follow API changes in anyconfig; anyconfig.to_container was deprecated
  and removed, etc.
- change: move test cases under tests/
- various small bug fixes and refactorings

* Wed Nov  9 2016 Satoru SATOH <ssato@redhat.com> - 0.1.0-1
- add schema file support if anyconfig >=0.0.10 is installed
- add python 3.5 support
- fix: make cheetah (dummy) engine works for python 3.x even if it's not
  available
- enhancement: implement basic renders method to tenjin module
- fix: encode str to byte correctly (especially for python 3.x)
- fix: follow API changes in python-anyconfig >= 0.5.0
- fix: initialize ctx even if options.cotentxs was empty
- some more minor fixes, refactorings and enhancements
- jumped up the version as it may be in stable enough

* Tue Jun 16 2015 Satoru SATOH <ssato@redhat.com> - 0.0.5-1
- fix bugs that template engine specific keyword options are not correctly
  processed in jinja2 and cheetah modules
- fix a lot of potential issues found by pylint and flake8
- make pep8/flake8 ignoring 'module level import not at top of file' error"
- various small bug fixes and refactorings

* Wed Jun  3 2015 Satoru SATOH <ssato@redhat.com> - 0.0.4-1
- fix a bug that _render cannot render alternate template passed by user
- [engines.jinja2] fix a bug that jinja2's exception while fetching template
  but failed is not caught
- fix a few bugs around the code to compute template search paths
- fix a bug that _render cannot render alternate template passed by user
- various small bug fixes and refactorings

* Tue May 12 2015 Satoru SATOH <ssato@redhat.com> - 0.0.3-1
- Changed the license from BSD to MIT as it's easier to understand
- Added an API to list available template engines
- Added mako support which was accidentally not in the supported engines list
- Added pystache support
- Various fixes and enhancements for warnings/errors/comments from flake8,
  pylint and other code inspection tools

* Sun May 10 2015 Satoru SATOH <ssato@redhat.com> - 0.0.2-1
- Fix a bug that the CLI tool does not work

* Fri May  1 2015 Satoru SATOH <ssato@redhat.com> - 0.0.1-1
- Initial packaging
